{% extends "skeleton.html" %}
{% block content %}
<script type="text/javascript">
    function reloadToShowAll()
    {
        const cbShowAll = document.getElementById( "cbShowAll" );
        var url = "/manage_tickets?show_all="

        url += cbShowAll.checked ? "true" : "false"
        window.location = url;
    }

    window.onload = function() {
        const cbShowAll = document.getElementById( "cbShowAll" );

        cbShowAll.checked = "{{ '1' if show_all else '0' }}" === '1';
    }
</script>

<div id="dvInnerContents">
    <div id="dvSpecificActions" class="clsMenu">
        {% if usr_info.is_admin() %}
        <a href="/manage_users">
            <img height="24px" width="24px" title="users management"
                 class="styled-button" src="/res/user.svg"/>
        </a>
        <br/>
        <a href="/report">
            <img height="24px" width="24px" title="send status report by e.mail"
                 class="styled-button" src="/res/email.svg"/>
        </a>
        <br/>
        {% endif %}
        <a href="/tickets/add">
            <img height="24px" width="24px" title="new ticket"
                 class="styled-button" src="/res/add.svg"/>
        </a>
        <br/>
        <a href="/tickets/toner">
            <img height="24px" width="24px" title="new ticket"
                 class="styled-button" src="/res/printer.svg"/>
        </a>
        <br/>
    </div>
    <div id="dvTitle">
        <img height="32px" width="32px" title="tickets" src="/res/ticket.svg"/>
        <b>Tickets</b>
    </div>
    <div id="dvBody">
        <div id="dvCfg">
            <input id="edSearch" type="text" placeholder="search" />
            <a href="/search?txt=">
                <img width="16px" height="16px" title="search"
                     class="styled-button" src="/res/search.svg"/>
            </a>
            <a href="/manage_tickets">
                <img width="16px" height="16px" title="reset"
                     class="styled-button" src="/res/reset.svg"/>
            </a>
            <input id="cbShowAll"
                   type="checkbox"
                   onchange="javascript: reloadToShowAll()"/>
             <label for="cbShowAll">Show also closed tickets.</label>
        </div>

        <p><table id="tblEntries">
        {% for ticket in tickets %}
            <tr class="tblEntryRow">
            <td>
            <a href="/tickets/chk?ticket_id={{ticket.key.urlsafe()}}">
                <img width="16px" height="16px" title="go"
                     class="styled-button" src="/res/settings.svg"/>
            </a>
            <a href="/tickets/modify?ticket_id={{ticket.key.urlsafe()}}">
                <img width="16px" height="16px" title="modify"
                     class="styled-button" src="/res/modify.svg"/>
            </a>
            {% if usr_info.is_admin() %}
                <a href="/tickets/delete?ticket_id={{ticket.key.urlsafe()}}">
                    <img width="16px" height="16px" title="delete"
                         class="styled-button" src="/res/delete.svg"/>
                </a>
            {%  endif %}
            </td>
            {% include "ticket_description.html" %}
            </tr>
        {% else %}
            No tickets yet.
        {% endfor %}
        </table></p>
    </div>
</div>
{% endblock %}
